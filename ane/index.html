<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç¾½èœå°‚ç”¨ ã‚«ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚«ãƒ¼</title>

<style>
body{
  margin:0;
  font-family:"Hiragino Maru Gothic ProN",sans-serif;
  background:#fff6ec;
  transition:background 0.6s ease;
}

.app{
  max-width:420px;
  margin:auto;
  padding:16px;
}

.header{
  text-align:center;
  margin-top:10px;
}

.header h1{
  font-size:22px;
  color:#d86c8f;
  margin:6px 0;
}

.header .sub{
  font-size:14px;
  color:#888;
}

.card{
  background:#fff;
  border-radius:22px;
  padding:16px;
  margin-top:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.1);
}

input{
  width:100%;
}


canvas{
  width:90%;          /* â† 100% â†’ 90% ã« */
  display:block;
  margin:12px auto 0;
  border-radius:16px;
}

.result{
  margin-top:10px;
  text-align:center;
}

.gage{
  height:18px;
  background:#eee;
  border-radius:10px;
  overflow:hidden;
  margin-top:10px;
}

.gage div{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ff8a80,#f06292);
  transition:width .6s;
}

.percent{
  margin-top:6px;
  color:#d86c8f;
  font-weight:bold;
}

</style>
</head>

<body>

<div class="app">

  <div class="header">
    <h1>ğŸ¨ ç¾½èœå°‚ç”¨ï¼ ã‚«ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚«ãƒ¼</h1>
    <div class="sub">Happy Birthday ç¾½èœ ğŸ</div>
  </div>

  <div class="card">
    <input type="file" accept="image/*" id="file">
    <canvas id="cv"></canvas>
  </div>

  <div class="card result" id="result" style="display:none">
    <div id="text"></div>
    <div class="gage"><div id="bar"></div></div>
    <div class="percent" id="percent"></div>
  </div>

</div>

<script>
const copics={
  E00:[255,230,200],R000:[255,220,220],RV21:[255,190,200],
  R35:[200,50,70],E93:[120,60,40],YR31:[255,200,120],
  Y02:[255,240,120],"W-2":[200,200,200],B02:[60,150,220],
  E31:[200,170,140],BV31:[190,170,220],BG23:[80,200,190],
  V15:[160,60,160],B000:[220,240,255],R02:[255,140,140],
  E29:[90,50,30],G05:[90,180,90],YG67:[90,140,60],
  E35:[140,90,60],RV06:[180,60,100]
};

const ratios=[[1,0],[0.7,0.3],[0.6,0.4]];

const cv=document.getElementById("cv");
const ctx=cv.getContext("2d");

document.getElementById("file").onchange=e=>{
  const img=new Image();
  img.onload=()=>{
    cv.width=img.width;
    cv.height=img.height;
    ctx.drawImage(img,0,0);
  }
  img.src=URL.createObjectURL(e.target.files[0]);
};

cv.onclick=e=>{
  const r=cv.getBoundingClientRect();
  const x=(e.clientX-r.left)*(cv.width/r.width);
  const y=(e.clientY-r.top)*(cv.height/r.height);
  const d=ctx.getImageData(x,y,1,1).data;
  document.body.style.background=`rgb(${d[0]},${d[1]},${d[2]})`;
  judge([d[0],d[1],d[2]]);
};

function dist(a,b){
  return Math.sqrt((a[0]-b[0])**2+(a[1]-b[1])**2+(a[2]-b[2])**2);
}
function mix(a,b,r1,r2){
  return [a[0]*r1+b[0]*r2,a[1]*r1+b[1]*r2,a[2]*r1+b[2]*r2];
}

function judge(t){
  let best={d:9999};
  const k=Object.keys(copics);

  k.forEach(c=>{
    const d=dist(t,copics[c]);
    if(d<best.d) best={type:"å˜è‰²",d,c};
  });

  for(let i=0;i<k.length;i++){
    for(let j=i+1;j<k.length;j++){
      ratios.forEach(r=>{
        const m=mix(copics[k[i]],copics[k[j]],r[0],r[1]);
        const d=dist(t,m);
        if(d<best.d){
          best={type:"æ··è‰²",d,c1:k[i],c2:k[j],ratio:`${r[0]*10}:${r[1]*10}`};
        }
      });
    }
  }

  const p=Math.max(0,Math.round(100-best.d/4));
  let html="";

  if(best.type==="å˜è‰²"){
    html=`ğŸ–Œ å˜è‰²ãŒä¸€ç•ªè¿‘ã„<br><b>${best.c}</b>`;
  }else{
    html=`ğŸ–Œ æ··è‰²ã—ãŸæ–¹ãŒè¿‘ã„<br>
    æ¯”ç‡ ${best.ratio}<br>
    å…ˆã«å¡—ã‚‹ â†’ <b>${best.c1}</b><br>
    å¾Œã‹ã‚‰å¡—ã‚‹ â†’ <b>${best.c2}</b>`;
  }

  document.getElementById("result").style.display="block";
  document.getElementById("text").innerHTML=html;
  document.getElementById("bar").style.width=p+"%";
  document.getElementById("percent").textContent=`ä¼¼ã¦ã‚‹åº¦ ${p}%`;
}
</script>

</body>
</html>
